import streamlit as st
import random
import pandas as pd
import time

# í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="ë§ˆì§€ë§‰ ë°”ë‚˜ë‚˜ ê²Œì„ ì‹œë®¬ë ˆì´ì…˜", layout="wide")

# --------------------
# 1. ì‚¬ì´ë“œë°”: ì„¤ì • ì˜ì—­
# --------------------
st.sidebar.header("âš™ï¸ ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •")
trials = st.sidebar.number_input("ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜ (N)", min_value=10, max_value=10000, value=100, step=10)
run_btn = st.sidebar.button("ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘! ğŸ²")

# ì´ë¡ ì  í™•ë¥  ì •ì˜
theory_win_a = 16 / 36  # ì•½ 44.4%
theory_win_b = 20 / 36  # ì•½ 55.6%

# --------------------
# 2. ë©”ì¸ í™”ë©´: ì„¤ëª… ë° ì‹¤í–‰
# --------------------
st.title("ğŸŒ ë§ˆì§€ë§‰ ë°”ë‚˜ë‚˜ ê²Œì„: ì§ê´€ vs í™•ë¥ ")
st.markdown("""
### ê²Œì„ ê·œì¹™
1. ë‘ ê°œì˜ ì£¼ì‚¬ìœ„ë¥¼ ë˜ì ¸ **ë” í° ìˆ«ì(ìµœëŒ“ê°’)**ë¥¼ ë´…ë‹ˆë‹¤.
2. ìµœëŒ“ê°’ì´ **1, 2, 3, 4**ì´ë©´ ğŸ‘‰ **A ìŠ¹ë¦¬** (ìˆ«ìê°€ 4ê°œë‹ˆê¹Œ ìœ ë¦¬í•´ ë³´ì„?)
3. ìµœëŒ“ê°’ì´ **5, 6**ì´ë©´ ğŸ‘‰ **B ìŠ¹ë¦¬** (ìˆ«ìê°€ 2ê°œë¿ì´ë¼ ë¶ˆë¦¬í•´ ë³´ì„?)
""")

st.divider()

if run_btn:
    # ë°ì´í„° ì €ì¥ì„ ìœ„í•œ ë¦¬ìŠ¤íŠ¸
    results = []
    win_a_count = 0
    win_b_count = 0
    
    # ì‹œê°í™” ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ìë¦¬ í‘œì‹œì (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ìš©)
    status_text = st.empty()
    bar_chart_placeholder = st.empty()
    
    # ì‹œë®¬ë ˆì´ì…˜ ë¡œì§
    # ì†ë„ë¥¼ ìœ„í•´ ë°ì´í„°í”„ë ˆì„ì„ í•œ ë²ˆì— ë§Œë“¤ì§€ ì•Šê³  ë¦¬ìŠ¤íŠ¸ì— ë‹´ìŒ
    for i in range(1, trials + 1):
        dice1 = random.randint(1, 6)
        dice2 = random.randint(1, 6)
        max_val = max(dice1, dice2)
        
        winner = "B"
        if max_val <= 4:
            winner = "A"
            win_a_count += 1
        else:
            win_b_count += 1
            
        results.append({
            "ì‹œë„": i,
            "ì£¼ì‚¬ìœ„1": dice1,
            "ì£¼ì‚¬ìœ„2": dice2,
            "ìµœëŒ“ê°’": max_val,
            "ìŠ¹ì": winner,
            "A ìŠ¹ë¥ (ëˆ„ì )": win_a_count / i,
            "B ìŠ¹ë¥ (ëˆ„ì )": win_b_count / i
        })

    # ë°ì´í„°í”„ë ˆì„ ë³€í™˜
    df = pd.DataFrame(results)
    
    # --------------------
    # 3. ê²°ê³¼ ì‹œê°í™”
    # --------------------
    
    # (1) ìµœì¢… ìŠ¤ì½”ì–´ ë³´ë“œ
    col1, col2, col3 = st.columns(3)
    col1.metric("ì´ ì‹œë„ íšŸìˆ˜", f"{trials}íšŒ")
    col2.metric("A ìŠ¹ë¦¬ íšŸìˆ˜ (ì´ë¡ : 44.4%)", f"{win_a_count}íšŒ", f"{win_a_count/trials*100:.1f}%")
    col3.metric("B ìŠ¹ë¦¬ íšŸìˆ˜ (ì´ë¡ : 55.6%)", f"{win_b_count}íšŒ", f"{win_b_count/trials*100:.1f}%")

    # (2) ìŠ¹ë¥  ë³€í™” ê·¸ë˜í”„ (ëŒ€ìˆ˜ì˜ ë²•ì¹™ ì‹œê°í™”)
    st.subheader("ğŸ“ˆ ì‹œí–‰ íšŸìˆ˜ì— ë”°ë¥¸ ìŠ¹ë¥  ë³€í™”")
    st.caption("ì‹œí–‰ íšŸìˆ˜ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ê·¸ë˜í”„ê°€ ì–´ë””ì— ìˆ˜ë ´í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”!")
    
    # ë¼ì¸ ì°¨íŠ¸ ë°ì´í„° ì •ë¦¬
    chart_data = df.set_index("ì‹œë„")[["A ìŠ¹ë¥ (ëˆ„ì )", "B ìŠ¹ë¥ (ëˆ„ì )"]]
    
    # ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    st.line_chart(chart_data, color=["#FF9F36", "#4B4B4B"]) # A:ì£¼í™©, B:ê²€ì •

    # (3) ìƒì„¸ ë°ì´í„° (í•™ìƒë“¤ì´ ì§ì ‘ ëˆˆìœ¼ë¡œ í™•ì¸)
    with st.expander("ğŸ² ìƒì„¸ ì£¼ì‚¬ìœ„ ê¸°ë¡ ë³´ê¸° (í´ë¦­)"):
        st.dataframe(df)

else:
    st.info("ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ íšŸìˆ˜ë¥¼ ì •í•˜ê³  'ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.")